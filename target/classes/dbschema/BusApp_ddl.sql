-- ###########################################
-- # Drop
-- ###########################################
-- Drop index

-- Drop many to many relations

-- Drop normal entities
DROP TABLE SEAT CASCADE;
DROP TABLE BUSCONNECTION CASCADE;
DROP TABLE DRIVER CASCADE;
DROP TABLE BUS CASCADE;

-- Drop pk sequence
DROP SEQUENCE hibernate_sequence;

-- ###########################################
-- # Create
-- ###########################################
-- Create pk sequence
CREATE SEQUENCE hibernate_sequence;

-- Create normal entities
CREATE TABLE BUS (
	ID BIGINT NOT NULL,
	BUSNUM INTEGER NOT NULL,
	BUSSPZ VARCHAR(100) NOT NULL,
	NUMBEROFSEATS INTEGER NOT NULL,
	UUID VARCHAR(36) NOT NULL,
	CREATEDDATE TIMESTAMP,
	CREATEDBY VARCHAR(50),
	LASTUPDATED TIMESTAMP,
	LASTUPDATEDBY VARCHAR(50),
	VERSION BIGINT NOT NULL
);

CREATE TABLE DRIVER (
	ID BIGINT NOT NULL,
	NAME VARCHAR(100) NOT NULL,
	AGE INTEGER NOT NULL,
	UUID VARCHAR(36) NOT NULL,
	CREATEDDATE TIMESTAMP,
	CREATEDBY VARCHAR(50),
	LASTUPDATED TIMESTAMP,
	LASTUPDATEDBY VARCHAR(50),
	VERSION BIGINT NOT NULL
);

CREATE TABLE BUSCONNECTION (
	ID BIGINT NOT NULL,
	DESTINATION VARCHAR(100) NOT NULL,
	MINSEATS INTEGER NOT NULL,
	STARTHOURS INTEGER NOT NULL,
	STARTMINUTES INTEGER NOT NULL,
	DURATIONMINUTES INTEGER NOT NULL,
	UUID VARCHAR(36) NOT NULL,
	DRIVER BIGINT NOT NULL,
	BUS BIGINT NOT NULL,
	CREATEDDATE TIMESTAMP,
	CREATEDBY VARCHAR(50),
	LASTUPDATED TIMESTAMP,
	LASTUPDATEDBY VARCHAR(50),
	VERSION BIGINT NOT NULL
);

CREATE TABLE SEAT (
	ID BIGINT NOT NULL,
	SEATNO INTEGER NOT NULL,
	RESERVATIONDATE TIMESTAMP NOT NULL,
	RESERVATIONKEY VARCHAR(100) NOT NULL,
	UUID VARCHAR(36) NOT NULL,
	SEATSTATUS VARCHAR(8),
	DIRECTION BIGINT NOT NULL,
	CREATEDDATE TIMESTAMP,
	CREATEDBY VARCHAR(50),
	LASTUPDATED TIMESTAMP,
	LASTUPDATEDBY VARCHAR(50),
	VERSION BIGINT NOT NULL
);


-- Create many to many relations

-- Primary keys
ALTER TABLE BUS ADD CONSTRAINT PK_BUS
	PRIMARY KEY (ID);
ALTER TABLE DRIVER ADD CONSTRAINT PK_DRIVER
	PRIMARY KEY (ID);
ALTER TABLE BUSCONNECTION ADD CONSTRAINT PK_BUSCONNECTION
	PRIMARY KEY (ID);
ALTER TABLE SEAT ADD CONSTRAINT PK_SEAT
	PRIMARY KEY (ID);

-- Unique constraints
ALTER TABLE BUS
	ADD CONSTRAINT UQ_BUS UNIQUE (UUID);
ALTER TABLE DRIVER
	ADD CONSTRAINT UQ_DRIVER UNIQUE (UUID);
ALTER TABLE BUSCONNECTION
	ADD CONSTRAINT UQ_BUSCONNECTION UNIQUE (UUID);
ALTER TABLE SEAT
	ADD CONSTRAINT UQ_SEAT UNIQUE (UUID);

-- Foreign key constraints


-- Reference from BusConnection.driver to Driver
ALTER TABLE BUSCONNECTION ADD CONSTRAINT FK_BUSCONNECTION_DRIVER
	FOREIGN KEY (DRIVER) REFERENCES DRIVER (ID);
CREATE INDEX IX_BUSCONNECTION_DRIVER ON BUSCONNECTION (DRIVER);

-- Reference from BusConnection.bus to Bus
ALTER TABLE BUSCONNECTION ADD CONSTRAINT FK_BUSCONNECTION_BUS
	FOREIGN KEY (BUS) REFERENCES BUS (ID);
CREATE INDEX IX_BUSCONNECTION_BUS ON BUSCONNECTION (BUS);

-- Reference from Seat.direction to BusConnection
ALTER TABLE SEAT ADD CONSTRAINT FK_SEAT_DIRECTION
	FOREIGN KEY (DIRECTION) REFERENCES BUSCONNECTION (ID);
CREATE INDEX IX_SEAT_DIRECTION ON SEAT (DIRECTION);

-- Index
